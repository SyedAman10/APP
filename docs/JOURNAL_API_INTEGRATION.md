# Journal API Integration Documentation

## üìã Overview

This document provides complete details about the Journal Entry API integration for the LMN8 mobile app.

## üîó API Base URL

```
https://lumen8health.com/api/backend
```

## üì° API Endpoints

| Method | Endpoint | Description | Auth Required |
|--------|----------|-------------|---------------|
| POST | `/journal/entries` | Create new journal entry | Yes |
| GET | `/journal/entries` | Get all entries (paginated) | Yes |
| GET | `/journal/entries/:id` | Get single entry | Yes |
| PUT | `/journal/entries/:id` | Update entry | Yes |
| DELETE | `/journal/entries/:id` | Delete entry | Yes |

## üîê Authentication

All requests require Bearer token authentication:

```
Authorization: Bearer {token}
```

The token is automatically included from the authenticated user session.

## üìù Data Models

### Journal Entry Object

```typescript
interface JournalEntry {
  id?: string;                    // Auto-generated by backend
  title: string;                  // Required, max 200 chars
  content: string;                // Required, max 10,000 chars
  mediaType: 'text' | 'photo' | 'handwritten';
  mood?: number;                  // Optional, 1-10 scale
  mediaUrl?: string;              // For photo/handwritten entries
  transcribedText?: string;       // For handwritten entries with OCR
  timestamp?: string;             // ISO 8601 format
  createdAt?: string;             // Auto-generated by backend
  updatedAt?: string;             // Auto-generated by backend
}
```

## üöÄ API Request Examples

### 1. Create Journal Entry (POST)

**Endpoint:** `POST /api/backend/journal/entries`

**Request Body (Written Entry):**
```json
{
  "title": "Morning Reflection",
  "content": "Feeling grateful for the new day. The sun is shining and I feel hopeful.",
  "mediaType": "text",
  "mood": 8
}
```

**Request Body (Photo Entry):**
```json
{
  "title": "Sunset at the Beach",
  "content": "Beautiful colors in the sky today",
  "mediaType": "photo",
  "mediaUrl": "https://storage.example.com/photos/123.jpg",
  "mood": 9
}
```

**Request Body (Handwritten Entry):**
```json
{
  "title": "Journal Page",
  "content": "Additional notes about this entry",
  "mediaType": "handwritten",
  "mediaUrl": "https://storage.example.com/handwritten/456.jpg",
  "transcribedText": "This is the transcribed text from OCR",
  "mood": 7
}
```

**Expected Response (Success):**
```json
{
  "success": true,
  "data": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "title": "Morning Reflection",
    "content": "Feeling grateful for the new day. The sun is shining and I feel hopeful.",
    "mediaType": "text",
    "mood": 8,
    "timestamp": "2025-01-14T10:30:00.000Z",
    "createdAt": "2025-01-14T10:30:00.000Z",
    "updatedAt": "2025-01-14T10:30:00.000Z"
  }
}
```

**Expected Response (Error):**
```json
{
  "success": false,
  "message": "Title is required",
  "error": "VALIDATION_ERROR"
}
```

### 2. Get All Entries (GET)

**Endpoint:** `GET /api/backend/journal/entries`

**Query Parameters (Optional):**
- `page`: Page number (default: 1)
- `limit`: Items per page (default: 10)

**Example:** `GET /api/backend/journal/entries?page=1&limit=20`

**Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "title": "Morning Reflection",
      "content": "Feeling grateful for the new day...",
      "mediaType": "text",
      "mood": 8,
      "timestamp": "2025-01-14T10:30:00.000Z",
      "createdAt": "2025-01-14T10:30:00.000Z",
      "updatedAt": "2025-01-14T10:30:00.000Z"
    },
    {
      "id": "234e5678-e89b-12d3-a456-426614174001",
      "title": "Evening Thoughts",
      "content": "Reflecting on the day...",
      "mediaType": "text",
      "mood": 6,
      "timestamp": "2025-01-13T18:45:00.000Z",
      "createdAt": "2025-01-13T18:45:00.000Z",
      "updatedAt": "2025-01-13T18:45:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 42,
    "totalPages": 3
  }
}
```

### 3. Get Single Entry (GET)

**Endpoint:** `GET /api/backend/journal/entries/:id`

**Example:** `GET /api/backend/journal/entries/123e4567-e89b-12d3-a456-426614174000`

**Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "title": "Morning Reflection",
    "content": "Feeling grateful for the new day. The sun is shining and I feel hopeful.",
    "mediaType": "text",
    "mood": 8,
    "timestamp": "2025-01-14T10:30:00.000Z",
    "createdAt": "2025-01-14T10:30:00.000Z",
    "updatedAt": "2025-01-14T10:30:00.000Z"
  }
}
```

### 4. Update Entry (PUT)

**Endpoint:** `PUT /api/backend/journal/entries/:id`

**Request Body (Partial Update):**
```json
{
  "title": "Updated Morning Reflection",
  "mood": 9
}
```

**Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "title": "Updated Morning Reflection",
    "content": "Feeling grateful for the new day. The sun is shining and I feel hopeful.",
    "mediaType": "text",
    "mood": 9,
    "timestamp": "2025-01-14T10:30:00.000Z",
    "createdAt": "2025-01-14T10:30:00.000Z",
    "updatedAt": "2025-01-14T11:15:00.000Z"
  }
}
```

### 5. Delete Entry (DELETE)

**Endpoint:** `DELETE /api/backend/journal/entries/:id`

**Expected Response:**
```json
{
  "success": true,
  "message": "Journal entry deleted successfully"
}
```

## ‚úÖ Field Validation Rules

### Required Fields (for creation):
- `title` - string, non-empty, max 200 characters
- `content` - string, non-empty, max 10,000 characters
- `mediaType` - enum: 'text' | 'photo' | 'handwritten'

### Optional Fields:
- `mood` - integer, 1-10 inclusive
- `mediaUrl` - string (valid URL)
- `transcribedText` - string, max 10,000 characters

### Auto-Generated Fields:
- `id` - UUID generated by backend
- `timestamp` - ISO 8601 datetime
- `createdAt` - ISO 8601 datetime
- `updatedAt` - ISO 8601 datetime

## üîç Frontend Implementation

### Files Updated:
1. **`services/APIService.ts`** - Added `journalAPI` with all CRUD operations
2. **`app/(main)/new-entry.tsx`** - Integrated with `journalAPI.createEntry()`
3. **`app/(tabs)/journey-log.tsx`** - Integrated with `journalAPI.getEntries()`

### Usage Examples:

```typescript
import { journalAPI } from '@/services/APIService';

// Create entry
const response = await journalAPI.createEntry({
  title: "My Entry",
  content: "Entry content...",
  mediaType: "text",
  mood: 8
});

// Get all entries
const entries = await journalAPI.getEntries(1, 20);

// Get single entry
const entry = await journalAPI.getEntry(id);

// Update entry
const updated = await journalAPI.updateEntry(id, {
  mood: 9
});

// Delete entry
await journalAPI.deleteEntry(id);
```

## üéØ Entry Type Specific Details

### Text Entry (mediaType: 'text')
- Primary use case: written journal entries
- Required: `title`, `content`, `mediaType`
- Optional: `mood`

### Photo Entry (mediaType: 'photo')
- Use case: visual journaling with images
- Required: `title`, `content`, `mediaType`, `mediaUrl`
- Optional: `mood`
- Note: Image upload handled separately, `mediaUrl` is the result

### Handwritten Entry (mediaType: 'handwritten')
- Use case: photos of handwritten journal pages with OCR
- Required: `title`, `mediaType`, `mediaUrl`
- Optional: `content`, `transcribedText`, `mood`
- Note: OCR processing handled separately, `transcribedText` is the result

## üìä Error Handling

The frontend handles these error scenarios:

1. **Validation Errors** - Missing required fields
2. **Network Errors** - Connection timeout or offline
3. **Authentication Errors** - Invalid or expired token
4. **Server Errors** - 500 status codes

All errors are displayed to the user with user-friendly messages.

## üîÑ Data Flow

### Creating an Entry:
1. User fills out form in `new-entry.tsx`
2. Form validates locally (title and content required)
3. `journalAPI.createEntry()` called with form data
4. API returns created entry with ID and timestamps
5. Success message shown, user redirected to journey log
6. Journey log refreshes to show new entry

### Loading Entries:
1. User navigates to journey log
2. `journalAPI.getEntries()` called on mount
3. API returns array of entries
4. Entries mapped to local format and displayed
5. Empty state shown if no entries exist

## üß™ Testing Commands

### Test Create Entry:
```bash
curl -X POST https://lumen8health.com/api/backend/journal/entries \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "title": "Test Entry",
    "content": "This is a test entry",
    "mediaType": "text",
    "mood": 7
  }'
```

### Test Get Entries:
```bash
curl -X GET https://lumen8health.com/api/backend/journal/entries \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Test Get Single Entry:
```bash
curl -X GET https://lumen8health.com/api/backend/journal/entries/ENTRY_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üìù Notes for Backend Developer

1. **Authentication**: All endpoints must validate Bearer token and associate entries with authenticated patient/user
2. **Pagination**: Implement pagination for GET /entries endpoint (default: page=1, limit=10)
3. **Sorting**: Return entries sorted by `createdAt` descending (newest first)
4. **Validation**: Enforce max lengths and required fields
5. **Timestamps**: Auto-generate `createdAt` on creation, update `updatedAt` on modification
6. **Media URLs**: If implementing file upload, provide signed URLs with appropriate expiration
7. **OCR Processing**: If implementing handwritten transcription, process async and update `transcribedText` field
8. **Soft Delete**: Consider implementing soft delete for data recovery
9. **Rate Limiting**: Implement appropriate rate limits to prevent abuse
10. **CORS**: Ensure CORS is properly configured for the mobile app domain

## üöÄ Status

- ‚úÖ API Service Layer Created
- ‚úÖ Create Entry Integrated
- ‚úÖ List Entries Integrated
- ‚è≥ Update Entry (UI not implemented yet)
- ‚è≥ Delete Entry (UI partially implemented)
- ‚è≥ Photo Upload (UI not implemented yet)
- ‚è≥ Handwritten + OCR (UI not implemented yet)

## üìû Contact

For questions about the API integration, contact the frontend development team.

---

Last Updated: January 2025

